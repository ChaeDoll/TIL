# Unity (유니티)  
## 유니티로 AR 정복하기  
### 3D 오브젝트 컨트롤 (2023.03.12)  
.obj파일 .fbx파일은 Unity에서 import할 수 있는 3D 파일들이다.  
이제부터는 C#을 사용하여 직접 코딩을 해야하는 부분이 나오기 시작한다.  
AR Session Origin에 AR Raycast Manager를 먼저 추가해준다.  
Raycast Manager를 통해 특정 부분에 레이저를 쏘고, 그 공간에 오브젝트를 띄우는 것을 할 것이다.  
그를 위해 오브젝트를 불러오거나 소환하고, 새로운 Emptys라는 가상오브젝트를 생성한다.  
이후 이 Emptys 오브젝트에 원하는 이름을 부여한 뒤 스크립트를 추가하여 원하는 기능을 하도록 만든다.  

오브젝트 방향이 뒤를 돌아있다면 오브젝트 배치 시 rotation값을 회전시켜주면 된다.  
만약 화면이 검은화면으로 나온다면 혹시 전면카메라를 쓰기위해 카메라 대상을 User로 해두지는 않았나 확인. World로 바꾼다.  

화면 위에 지속적으로 떠있게 하기 위해서 UpdateCenterObject라는 메소드를 만들어 보았는데,  
스마트폰 화면 중앙부분에서 Raycasting을 하고, 벽 혹은 바닥의 거리를 측정한다.  
그리고는 그 거리만큼 떨어져있는 좌표에 오브젝트 위치와 각도를 변경시킨다.  
AR RayCasting이 된것들이 hits에 리스트로 쌓이는데 처음 감지되는 곳에 위치를 고정시키고,  
이 동작들을 프레임마다 실행시켜서 Update 시킨다.  

이 과정을 거치고나선 터치한 위치에 오브젝트를 위치하게 만드는 메소드를 작성했다.  
이 방식은 스마트폰 화면을 터치하면 Input된 터치의 정보가 저장되고,  
그 중에서 첫 번째로 터치된 곳의 위치에 AR RayCast를 매칭시키고, 그 좌표에 오브젝트를 생성한다.  
처음엔 생성된 오브젝트가 없었기에 placeObject를 통해 터치한 곳에 Object를 생성하고,  
이후 오브젝트가 생성된 상태에서는 생성된 오브젝트의 position과 rotation만 갱신해주면 된다.  

이 과정에서 처음에는 오브젝트가 터치하기 이전에 실행하자마자 맵에 존재했고,  
터치하여 Object spawn을 했을 때 두 번째 오브젝트가 생성되어 총 맵에 2개의 객체가 존재했다.  
알고보니, Hierarchy(작업공간)에 Cube Object로 내가 생성해둔 것이있는데, 여기에 생성하는 순간 애초에  
맵에 바로 등장하기때문에 나타난 오류였다.  
그래서 작업공간이 아닌 Assets에 object폴더를 따로 두고, 그곳에 있는 Object를 불러오는 방식으로 변경했다.  

내가 또한 public GameObject placeObject; 선언을 지우고 spawnObject 기능을 선언했는데,  
생각해보니 spawnObject 자체가 placeObject를 실체화함수와 함께 거쳐서 만들어진 객체였기에  
placeObject를 지우면 코드 전체적인 오류가 생기는 것이었다.  

현재 이렇게 빌드를 마치고 나서 아쉬운점이 있다면  
RayCast를 통해 벽 혹은 바닥의 위치를 파악하고 그 점들을 이어서 면을 만드는 것 까지는 좋으나,  
파악하는 과정에서 그렇게 정확도가 높지도 않을 뿐더러 한 번 만들어진 바닥 위에 또 새로운 바닥이 겹겹이 쌓이다보니  
결국에는 물체를 놓기위해 바닥을 클릭했는데 허공에 있는 가상의 바닥 위에 물체가 생성되어  
공중에 물체가 떠있는 기이한 현상이 만들어졌다.  
인식되어 바닥면을 만들때, 바닥면의 지속시간을 줄이거나 혹은 바닥위에 또 새로운 바닥이 생성되지 않도록 하는 등의  
설계 방식이 필요로해보였다.  
