## 예정
- 발표용 PPT 제작 예정
  - 분량 : 백엔드 시작 ~ AI 기능 구현까지 (크롤링 기능 구현 및 프론트엔드 화면 구현은 나중에)
    

# 문제 해결
- Youtube로 크롤링을 진행하였으나, 유튜브는 동적으로 영상들을 관리하기에 Jsoup 라이브러리를 통해 정적 html파일을 분석했을 때 영상에 대한 요소가 반환되지 않았음. 내가 가져와야 하는 것은 사진, URL이었음.
- 처음엔 그리하여 userAgent라는 유저정보를 넣어서 Jsoup을 Connect하고, 동적으로 관리하는 것을 가져오기 위해 script 태그를 선택하여 그 내부에 있는 요소들을 선택하기 시작했음.
```
String crawlingURL = "https://www.youtube.com/results?search_query=" + encodedKeyword;
            Document document = Jsoup.connect(crawlingURL).userAgent(userAgent).get();
            Elements datas = document.select("script");
            for (Element data : datas) {
                for (DataNode node : data.dataNodes()) {
                    if (node.getWholeData().contains("var ytInitialData = ")) {
                        String nodeData = node.getWholeData();
                        nodeData = nodeData.replace("var ytInitialData = ", "");
                        nodeData = nodeData.replace(nodeData.substring(nodeData.length() - 1), "");
                        // 썸네일 이미지
                        Object thumbnail = JsonPath.read(nodeData, "$.contents.twoColumnSearchResultsRenderer.primaryContents.sectionListRenderer.contents[0].itemSectionRenderer.contents[0].videoRenderer.thumbnail.thumbnails[0].url");
                        // 유튜브 제목
                        String title = recommend;
                        // 유튜브 링크
                        Object link = "https://www.youtube.com" + JsonPath.read(nodeData, "$.contents.twoColumnSearchResultsRenderer.primaryContents.sectionListRenderer.contents[0].itemSectionRenderer.contents[0].videoRenderer.navigationEndpoint.commandMetadata.webCommandMetadata.url");
                        music.setImage((String)thumbnail);
                        music.setTitle(title);
                        music.setUrl((String)link);
                    }
                }
            }
```
- 이러한 코드를 통해 유튜브에 있는 썸네일, 링크를 가져온 뒤, music 객체에 setter를 통해 정해주고 해당 music객체를 List로 반환하여 프론트엔드에서 사용가능한 data로 만들었음
### 문제 발생
- 어제까지는 문제가 없어보였으나, 사실 이 과정에서 동작하는 확률이 70%~80%정도로 낮았음.
  - 이 때문에 프론트엔드를 구현할 때에도 AI 음악 추천 기능을 먼저 받아서 화면에 보여주고, 크롤링 된 image, url을 이후에 덧붙여주는 방식으로 구현하여 혹여나 크롤링이 실패하더라도 사용자에게 음악 추천은 가능하도록 구현하였음.
- 하지만 실제 서비스에서는 이러한 문제는 사용자에게 큰 불만족으로 다가올 수 있다고 생각하였고, 크롤링 기능을 여러번 try하여 값을 가져올 때까지 시도하려고 하였음.
### 문제 해결 방안
- 계속 구현을 위해 노력하던 중, 새로운 방안이 문득 떠올랐음. Youtube에 검색하여 결과를 얻는 목적이 오로지 'Thumbnail'과 'URL link'라면, 사실 Google 검색결과에서도 이를 받아올 수 있지 않을까 생각하였음.
- 왜냐면 Google의 동영상 검색결과는 Youtube 링크를 최상단에 배치하기에 영상의 이미지와 URL을 얻는데에 큰 차이가 없으리라 생각하였음.
<img src="https://github.com/ChaeDoll/TIL/assets/108540812/cf0da2a3-4ed2-4dcd-82a7-099296785ddf" width="40%"/>
<img src="https://github.com/ChaeDoll/TIL/assets/108540812/57eb02da-79e3-4a91-8852-95f9588136f3" width="40%"/>

