## 섹션 9 이어서..  
### 프로토타입과 싱글톤 빈을 함께 사용할 시 발생하는 문제  
그러면 프로토타입과 싱글톤을 함께 쓰면 어떠한 문제가 생기는가?  
우선 클라이언트가 프로토타입빈을 요청하고 그 내부에 count라는 필드가 있으며 빈이 생성된 이후 1씩 올라가도록 설정한다.  
프로토타입 빈의 경우엔 당연하게도 1번 빈과 2번 빈의 count값이 둘 다 1일 것이다.  
하지만 여기에서 싱글톤에서 프로토타입의 빈을 사용하는 상황을 추가해본다..  
싱글톤의 클라이언트 빈이 의존관계로서 프로토타입 빈을 호출한다면 주입 시점에 컨테이너에 프로토타입 빈을 요청할 것이다.  
그렇게 만들어진 프로토타입 빈은 클라이언트 빈에 반환되어 클라이언트 빈(싱글톤)이 관리한다.  
이제 클라이언트 빈이 내부에 프로토타입 빈을 보관한다.  
여기에서 클라이언트가 싱글톤의 클라이언트 빈을 통해 로직을 요청하고, 싱글톤의 특성 상 같은 빈을 반환받는다.  
위에있는 count 예시로 생각해보면, 싱글톤 클라이언트 빈은 클라이언트에게 로직(addCount)을 요청받으면 DI되어 가지고있던 프로토타입 빈의 내부에 있는 count값을 0->1로 증가시킬 것이다. 그리고 그 값을 클라이언트에게 반환할 것이다.  
그런데! 여기서 다른 클라이언트가 클라이언트 빈에서 addCount를 요청하는 상황이 생길 수 있다.  
문제는, 두 번째 클라이언트는 프로토타입 빈을 기대하여 addCount를 최초로 요청했으니 0->1의 count값을 기대할 것이다.  
하지만 싱글톤 클라이언트의 특성 상 같은 빈을 사용하기 때문에 이미 DI 되어있는 프로토타입 빈에 연결되어있어 1->2의 count값을 반환받게 된다.  
즉, 프로토타입 빈을 사용했지만 사실 상 프로토타입의 역할을 하지 않는다.  
아마 사용할 때마다 새로 생성하여 사용하는 방식을 원해서 프로토타입을 사용했을 것이다.  
물론 가능은 하다. 클라이언트 빈에 있는 로직 메소드 내부에 프로토타입 빈을 getBean을 하는 방법도 있긴 하다... 근데 좋은 코드는 아니다. 너무 스프링 의존적임  

### 해결방법은 Provider 사용  
의존관계를 주입받는게 아니라, 직접 필요한 의존관계를 찾는걸 DL(Dependency Lookup)이라고 한다.  
지금 필요한건 프로토타입 빈을 컨테이너에서 대신 찾아주는 기능 딱 하나 정도만 있으면 된다.  
DL을 대신 해주는게 이미 스프링에 있으니.. 바로 ObjectFactory와 ObjectProvider가 있다.  
Provider를 사용하면서 getObject를 통해 새로운 prototypeBean을 생성하도록 한다.  
ObjectFactory와 ObjectProvider 둘 다 똑같은것이긴 한데, 그냥 같은 방식으로 사용한다.  
ObjectFactory는 딱 getObject만 제공하고 ObjectProvider은 편의적인 추가 기능이 더 있는 것이다.  
이것의 핵심은 스프링 컨테이너를 통해 DL을 간단하게 도와주는것이다. 직접 조회보다 대리 조회에 의미가 있음  
'스프링에 의존적'인 기능이긴 하지만 기능이 단순해서 테스트 만들기가 쉬워진다.  
Object Provider는 지금 딱 필요한 DL정도 기능만 제공  
스프링에 의존하지 않는 다른 방법도 있다. 자바 표준의 Provider를 사용하는 방법이다.  
get()만 쓰면 되는 간단한 기능이라는 장점이 존재한다. 또한 스프링이 아닌 컨테이너에서도 사용 가능하다.  
단점은 gradle에 라이브러리를 추가해야함. 이것만 빼면 좋다.  
그러면 프로토타입 빈은 언제 사용하는지도 중요할 것이다.  
실무에서 막상 개발해보면 싱글톤 빈으로 대부분 문제해결이 가능하다.  
따라서 프로토타입 빈을 직접적으로 사용하는 일은 매우 드물 것이다.  
참고로 ObjectProvider이나 자바표준Provider은 꼭 프로토타입 빈이 아니더라도 언제든 제각각 상황에서 사용가능하다. (매뉴얼을 보면 된다.)  
스프링에 있는 @Lookup 애노테이션이라는 것도 있다. 고려할 것이 많아서 생략  
> 실무에서 자바표준Provider을 쓸지 스프링의 ObjectProvider를 사용할지 고민될 수 있다.  
기본적으로는 ObjectProvider가 DL을 위한 편의기능이 많아서 좋지만, 혹여나 스프링이 아닌 다른 컨테이너에서도 사용해야하는 경우엔 자바표준 Provider를 사용한다.  

스프링을 쓰다보면 다른 기능들에서도 '자바표준'과 '스프링 제공 기능'이 겹치는 경우가 종종 발생한다.  
대부분의 상황에서는 스프링이 더 다양하고 편리하기에 다른 컨테이너를 쓸 일이 없다면 스프링에서 제공하는 기능을 쓰면 된다.  
스프링이 '사실상 기술표준'처럼 여겨진다.  
JPA관련해선 JPA 표준이 승리함. 그래서 표준꺼를 쓰지만  
스프링에서는 기능을 직접 보고 정하는게 낫다. 표준관련해서 스프링에서도 권장하는 경우도 있고 표준의 기능이 만약 내가 원하는만큼 딱 깔끔하면 그걸 택해도 좋다.  
자기 마음이긴하다. 그냥 스프링 기능을 쓸지 자바표준을 쓸지.  

### 웹 스코프


## 섹션 10 - 다음으로  
